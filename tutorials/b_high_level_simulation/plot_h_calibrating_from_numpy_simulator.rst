
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorials/b_high_level_simulation/plot_h_calibrating_from_numpy_simulator.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


Calibrating an Unknown Op-Amp Pole from Data
============================================

.. GENERATED FROM PYTHON SOURCE LINES 6-11

.. code-block:: default

    import cbadc
    import numpy as np
    import matplotlib.pyplot as plt
    import copy








.. GENERATED FROM PYTHON SOURCE LINES 12-15

Setup proxy simulators from numpy data
--------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 15-27

.. code-block:: default

    specification_false = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_FALSE.dict')
    specification_ref = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_TRUE.dict')
    T = specification_ref['T']
    BW = specification_ref['fc']
    N = specification_false['N']
    M = N + 1

    ctrl_bits_test_uncalibrated = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_ref = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_cal = cbadc.simulator.NumpySimulator('op-amp_data/s_test.npy')
    ctrl_bits_train = cbadc.simulator.NumpySimulator('op-amp_data/s_train.npy')








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Instantiate Analog Systems, Digital Controls, and Nominal FIR Filters
----------------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 31-73

.. code-block:: default


    analog_system = cbadc.analog_system.AnalogSystem(
        specification_false['A'],
        specification_false['B'],
        np.eye(specification_false['N']),
        specification_false['Gamma'],
        specification_false['Gamma'].transpose(),
    )
    analog_system_ref = cbadc.analog_system.AnalogSystem(
        specification_ref['A'],
        specification_ref['B'],
        np.eye(specification_ref['N']),
        specification_ref['Gamma'],
        specification_ref['Gamma'].transpose(),
    )

    digital_control = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_false['T']), M
    )
    digital_control_ref = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_ref['T']), M
    )

    eta2 = (
        np.linalg.norm(
            analog_system_ref.transfer_function_matrix(
                np.array([2 * np.pi * specification_ref['fc']])
            )
        )
        ** 2
    )
    K1 = 1 << 8
    K2 = K1

    fir_filter = cbadc.digital_estimator.FIRFilter(
        analog_system, digital_control, eta2, K1, K2
    )

    fir_filter_ref = cbadc.digital_estimator.FIRFilter(
        analog_system_ref, digital_control_ref, eta2, K1, K2
    )








.. GENERATED FROM PYTHON SOURCE LINES 74-77

Setup testing simulations for verification
---------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 77-95

.. code-block:: default


    # Ref
    uncalibrated_filter = copy.deepcopy(fir_filter)
    uncalibrated_filter(ctrl_bits_test_uncalibrated)


    fir_filter_ref(ctrl_bits_test_ref)


    size = 1 << 14
    u_hat_ref = np.zeros(size)
    u_hat_uncalibrated = np.zeros(size)
    for index in range(size):
        u_hat_ref[index] = next(fir_filter_ref)
        u_hat_uncalibrated[index] = next(uncalibrated_filter)
    u_hat_cut_ref = u_hat_ref[K1 + K2 :]
    u_hat_cut_uncalibrated = u_hat_uncalibrated[K1 + K2 :]








.. GENERATED FROM PYTHON SOURCE LINES 96-99

Instantiate adaptive filter and set buffer training data size
-------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 99-104

.. code-block:: default

    training_data_size = 1 << 15 - 1
    adaptive_filter = cbadc.digital_estimator.AdaptiveFilter(
        fir_filter, 0, training_data_size
    )








.. GENERATED FROM PYTHON SOURCE LINES 105-108

Instantiate the training instance
----------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 108-112

.. code-block:: default

    calibrator = cbadc.digital_calibration.Calibration(
        adaptive_filter, ctrl_bits_train, ctrl_bits_test_cal
    )








.. GENERATED FROM PYTHON SOURCE LINES 113-118

Train adaptive filter
----------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 118-130

.. code-block:: default

    epochs = 1 << 16


    def step_size(x):
        return 1e-1 / ((1 + x ** (0.01)))


    batch_size = 1 << 6

    calibrator.compute_step_size_template()
    calibrator.train(epochs, step_size, batch_size, stochastic_delay=0)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/65536 [00:00<?, ?it/s]      0%|          | 1/65536 [00:00<5:24:41,  3.36it/s]      0%|          | 76/65536 [00:00<04:26, 245.66it/s]      0%|          | 154/65536 [00:00<02:37, 413.84it/s]      0%|          | 232/65536 [00:00<02:03, 526.73it/s]      0%|          | 310/65536 [00:00<01:48, 603.85it/s]      1%|          | 388/65536 [00:00<01:39, 656.97it/s]      1%|          | 467/65536 [00:00<01:33, 694.63it/s]      1%|          | 544/65536 [00:01<01:30, 716.87it/s]      1%|          | 620/65536 [00:01<01:29, 724.07it/s]      1%|1         | 697/65536 [00:01<01:27, 737.22it/s]      1%|1         | 774/65536 [00:01<01:26, 746.65it/s]      1%|1         | 851/65536 [00:01<01:25, 752.71it/s]      1%|1         | 930/65536 [00:01<01:24, 762.60it/s]      2%|1         | 1007/65536 [00:01<01:24, 762.07it/s]      2%|1         | 1084/65536 [00:01<01:24, 761.74it/s]      2%|1         | 1161/65536 [00:01<01:24, 758.37it/s]      2%|1         | 1238/65536 [00:01<01:24, 759.51it/s]      2%|2         | 1315/65536 [00:02<01:24, 756.76it/s]      2%|2         | 1391/65536 [00:02<01:24, 755.33it/s]      2%|2         | 1468/65536 [00:02<01:24, 758.09it/s]      2%|2         | 1545/65536 [00:02<01:24, 760.94it/s]      2%|2         | 1624/65536 [00:02<01:23, 769.26it/s]      3%|2         | 1704/65536 [00:02<01:22, 775.70it/s]      3%|2         | 1782/65536 [00:02<01:22, 773.55it/s]      3%|2         | 1860/65536 [00:02<01:22, 768.82it/s]      3%|2         | 1937/65536 [00:02<01:23, 765.91it/s]      3%|3         | 2014/65536 [00:02<01:23, 763.04it/s]      3%|3         | 2091/65536 [00:03<01:23, 760.45it/s]      3%|3         | 2168/65536 [00:03<01:23, 761.24it/s]      3%|3         | 2245/65536 [00:03<01:23, 762.15it/s]      4%|3         | 2323/65536 [00:03<01:22, 766.13it/s]      4%|3         | 2400/65536 [00:03<01:22, 765.09it/s]      4%|3         | 2477/65536 [00:03<01:22, 765.11it/s]      4%|3         | 2556/65536 [00:03<01:21, 772.50it/s]      4%|4         | 2636/65536 [00:03<01:20, 777.83it/s]      4%|4         | 2714/65536 [00:03<01:20, 776.19it/s]      4%|4         | 2792/65536 [00:03<01:20, 777.08it/s]      4%|4         | 2870/65536 [00:04<01:20, 775.81it/s]      4%|4         | 2948/65536 [00:04<01:20, 774.81it/s]      5%|4         | 3026/65536 [00:04<01:21, 769.34it/s]      5%|4         | 3103/65536 [00:04<01:21, 768.38it/s]      5%|4         | 3180/65536 [00:04<01:21, 765.69it/s]      5%|4         | 3257/65536 [00:04<01:21, 763.49it/s]      5%|5         | 3334/65536 [00:04<01:21, 764.78it/s]      5%|5         | 3412/65536 [00:04<01:20, 767.48it/s]      5%|5         | 3491/65536 [00:04<01:20, 772.30it/s]      5%|5         | 3569/65536 [00:04<01:20, 773.25it/s]      6%|5         | 3647/65536 [00:05<01:20, 772.48it/s]      6%|5         | 3725/65536 [00:05<01:19, 773.11it/s]      6%|5         | 3803/65536 [00:05<01:19, 774.16it/s]      6%|5         | 3881/65536 [00:05<01:19, 773.46it/s]      6%|6         | 3959/65536 [00:05<01:19, 773.65it/s]      6%|6         | 4037/65536 [00:05<01:19, 773.74it/s]      6%|6         | 4115/65536 [00:05<01:19, 773.94it/s]      6%|6         | 4193/65536 [00:05<01:19, 774.03it/s]      7%|6         | 4271/65536 [00:05<01:19, 767.80it/s]      7%|6         | 4348/65536 [00:05<01:20, 760.63it/s]      7%|6         | 4425/65536 [00:06<01:20, 761.94it/s]      7%|6         | 4503/65536 [00:06<01:19, 765.38it/s]      7%|6         | 4580/65536 [00:06<01:19, 765.61it/s]      7%|7         | 4658/65536 [00:06<01:19, 768.20it/s]      7%|7         | 4736/65536 [00:06<01:18, 770.83it/s]      7%|7         | 4814/65536 [00:06<01:18, 772.21it/s]      7%|7         | 4892/65536 [00:06<01:19, 766.74it/s]      8%|7         | 4970/65536 [00:06<01:18, 769.42it/s]      8%|7         | 5047/65536 [00:06<01:18, 768.84it/s]      8%|7         | 5124/65536 [00:06<01:18, 768.91it/s]      8%|7         | 5202/65536 [00:07<01:18, 770.43it/s]      8%|8         | 5280/65536 [00:07<01:19, 762.24it/s]      8%|8         | 5357/65536 [00:07<01:19, 756.91it/s]      8%|8         | 5433/65536 [00:07<01:19, 755.52it/s]      8%|8         | 5510/65536 [00:07<01:19, 757.18it/s]      9%|8         | 5588/65536 [00:07<01:18, 761.69it/s]      9%|8         | 5666/65536 [00:07<01:18, 765.60it/s]      9%|8         | 5744/65536 [00:07<01:17, 768.33it/s]      9%|8         | 5822/65536 [00:07<01:17, 770.58it/s]      9%|9         | 5900/65536 [00:07<01:17, 772.02it/s]      9%|9         | 5978/65536 [00:08<01:17, 773.31it/s]      9%|9         | 6056/65536 [00:08<01:17, 770.91it/s]      9%|9         | 6134/65536 [00:08<01:17, 769.11it/s]      9%|9         | 6212/65536 [00:08<01:17, 769.63it/s]     10%|9         | 6291/65536 [00:08<01:16, 774.13it/s]     10%|9         | 6369/65536 [00:08<01:16, 773.25it/s]     10%|9         | 6447/65536 [00:08<01:16, 772.44it/s]     10%|9         | 6525/65536 [00:08<01:16, 772.06it/s]     10%|#         | 6603/65536 [00:08<01:16, 772.96it/s]     10%|#         | 6681/65536 [00:08<01:16, 773.50it/s]     10%|#         | 6759/65536 [00:09<01:15, 773.70it/s]     10%|#         | 6837/65536 [00:09<01:15, 773.24it/s]     11%|#         | 6915/65536 [00:09<01:15, 773.32it/s]     11%|#         | 6993/65536 [00:09<01:15, 773.39it/s]     11%|#         | 7071/65536 [00:09<01:15, 773.34it/s]     11%|#         | 7149/65536 [00:09<01:15, 773.48it/s]     11%|#1        | 7227/65536 [00:09<01:15, 773.92it/s]     11%|#1        | 7305/65536 [00:09<01:15, 773.67it/s]     11%|#1        | 7383/65536 [00:09<01:15, 773.85it/s]     11%|#1        | 7461/65536 [00:09<01:15, 773.85it/s]     12%|#1        | 7539/65536 [00:10<01:14, 773.72it/s]     12%|#1        | 7617/65536 [00:10<01:14, 773.82it/s]     12%|#1        | 7695/65536 [00:10<01:14, 773.66it/s]     12%|#1        | 7773/65536 [00:10<01:14, 773.87it/s]     12%|#1        | 7851/65536 [00:10<01:14, 774.90it/s]     12%|#2        | 7929/65536 [00:10<01:14, 774.45it/s]     12%|#2        | 8007/65536 [00:10<01:14, 769.51it/s]     12%|#2        | 8084/65536 [00:10<01:15, 765.29it/s]     12%|#2        | 8161/65536 [00:10<01:15, 763.38it/s]     13%|#2        | 8238/65536 [00:11<01:14, 765.23it/s]     13%|#2        | 8316/65536 [00:11<01:14, 766.95it/s]     13%|#2        | 8394/65536 [00:11<01:14, 768.39it/s]     13%|#2        | 8472/65536 [00:11<01:14, 770.34it/s]     13%|#3        | 8550/65536 [00:11<01:14, 763.11it/s]     13%|#3        | 8628/65536 [00:11<01:14, 765.90it/s]     13%|#3        | 8705/65536 [00:11<01:14, 761.41it/s]     13%|#3        | 8783/65536 [00:11<01:14, 765.97it/s]     14%|#3        | 8862/65536 [00:11<01:13, 772.81it/s]     14%|#3        | 8942/65536 [00:11<01:12, 778.06it/s]     14%|#3        | 9022/65536 [00:12<01:12, 782.20it/s]     14%|#3        | 9102/65536 [00:12<01:11, 785.49it/s]     14%|#4        | 9182/65536 [00:12<01:11, 787.76it/s]     14%|#4        | 9262/65536 [00:12<01:11, 789.74it/s]     14%|#4        | 9342/65536 [00:12<01:11, 791.35it/s]     14%|#4        | 9422/65536 [00:12<01:11, 789.12it/s]     14%|#4        | 9502/65536 [00:12<01:10, 789.92it/s]     15%|#4        | 9582/65536 [00:12<01:10, 790.52it/s]     15%|#4        | 9662/65536 [00:12<01:10, 790.84it/s]     15%|#4        | 9742/65536 [00:12<01:10, 790.91it/s]     15%|#4        | 9822/65536 [00:13<01:10, 788.89it/s]     15%|#5        | 9902/65536 [00:13<01:10, 789.97it/s]     15%|#5        | 9982/65536 [00:13<01:10, 790.21it/s]     15%|#5        | 10062/65536 [00:13<01:10, 790.55it/s]     15%|#5        | 10142/65536 [00:13<01:10, 791.28it/s]     16%|#5        | 10222/65536 [00:13<01:09, 792.06it/s]     16%|#5        | 10302/65536 [00:13<01:09, 791.37it/s]     16%|#5        | 10382/65536 [00:13<01:11, 776.41it/s]     16%|#5        | 10460/65536 [00:13<01:11, 769.77it/s]     16%|#6        | 10538/65536 [00:13<01:11, 770.05it/s]     16%|#6        | 10616/65536 [00:14<01:11, 767.30it/s]     16%|#6        | 10694/65536 [00:14<01:11, 768.17it/s]     16%|#6        | 10772/65536 [00:14<01:11, 769.78it/s]     17%|#6        | 10849/65536 [00:14<01:11, 768.52it/s]     17%|#6        | 10926/65536 [00:14<01:11, 765.69it/s]     17%|#6        | 11004/65536 [00:14<01:11, 767.51it/s]     17%|#6        | 11082/65536 [00:14<01:10, 768.35it/s]     17%|#7        | 11159/65536 [00:14<01:11, 762.64it/s]     17%|#7        | 11236/65536 [00:14<01:11, 764.74it/s]     17%|#7        | 11314/65536 [00:14<01:10, 766.58it/s]     17%|#7        | 11391/65536 [00:15<01:11, 761.09it/s]     18%|#7        | 11469/65536 [00:15<01:10, 764.75it/s]     18%|#7        | 11547/65536 [00:15<01:10, 767.62it/s]     18%|#7        | 11625/65536 [00:15<01:10, 769.98it/s]     18%|#7        | 11703/65536 [00:15<01:09, 771.58it/s]     18%|#7        | 11781/65536 [00:15<01:09, 771.63it/s]     18%|#8        | 11859/65536 [00:15<01:09, 768.15it/s]     18%|#8        | 11936/65536 [00:15<01:10, 763.16it/s]     18%|#8        | 12013/65536 [00:15<01:09, 764.73it/s]     18%|#8        | 12090/65536 [00:15<01:10, 762.58it/s]     19%|#8        | 12169/65536 [00:16<01:09, 769.63it/s]     19%|#8        | 12248/65536 [00:16<01:08, 773.66it/s]     19%|#8        | 12326/65536 [00:16<01:09, 770.04it/s]     19%|#8        | 12404/65536 [00:16<01:09, 767.31it/s]     19%|#9        | 12481/65536 [00:16<01:09, 767.92it/s]     19%|#9        | 12559/65536 [00:16<01:08, 768.58it/s]     19%|#9        | 12637/65536 [00:16<01:08, 769.65it/s]     19%|#9        | 12715/65536 [00:16<01:08, 770.28it/s]     20%|#9        | 12793/65536 [00:16<01:08, 765.33it/s]     20%|#9        | 12871/65536 [00:16<01:08, 767.61it/s]     20%|#9        | 12949/65536 [00:17<01:08, 768.54it/s]     20%|#9        | 13028/65536 [00:17<01:07, 774.84it/s]     20%|##        | 13108/65536 [00:17<01:07, 780.23it/s]     20%|##        | 13188/65536 [00:17<01:06, 784.04it/s]     20%|##        | 13268/65536 [00:17<01:06, 786.61it/s]     20%|##        | 13348/65536 [00:17<01:06, 788.88it/s]     20%|##        | 13428/65536 [00:17<01:05, 790.61it/s]     21%|##        | 13508/65536 [00:17<01:05, 789.11it/s]     21%|##        | 13587/65536 [00:17<01:06, 780.38it/s]     21%|##        | 13666/65536 [00:18<01:06, 777.53it/s]     21%|##        | 13744/65536 [00:18<01:06, 776.26it/s]     21%|##1       | 13822/65536 [00:18<01:06, 775.98it/s]     21%|##1       | 13900/65536 [00:18<01:06, 775.63it/s]     21%|##1       | 13978/65536 [00:18<01:06, 775.63it/s]     21%|##1       | 14056/65536 [00:18<01:06, 774.81it/s]     22%|##1       | 14134/65536 [00:18<01:06, 775.27it/s]     22%|##1       | 14212/65536 [00:18<01:06, 775.33it/s]     22%|##1       | 14290/65536 [00:18<01:06, 775.98it/s]     22%|##1       | 14368/65536 [00:18<01:05, 775.65it/s]     22%|##2       | 14446/65536 [00:19<01:05, 775.99it/s]     22%|##2       | 14524/65536 [00:19<01:05, 776.34it/s]     22%|##2       | 14602/65536 [00:19<01:05, 776.39it/s]     22%|##2       | 14680/65536 [00:19<01:05, 776.69it/s]     23%|##2       | 14758/65536 [00:19<01:05, 775.86it/s]     23%|##2       | 14836/65536 [00:19<01:05, 776.62it/s]     23%|##2       | 14914/65536 [00:19<01:05, 777.10it/s]     23%|##2       | 14992/65536 [00:19<01:05, 776.98it/s]     23%|##2       | 15070/65536 [00:19<01:04, 776.98it/s]     23%|##3       | 15148/65536 [00:19<01:04, 776.90it/s]     23%|##3       | 15226/65536 [00:20<01:04, 776.88it/s]     23%|##3       | 15304/65536 [00:20<01:04, 776.75it/s]     23%|##3       | 15382/65536 [00:20<01:04, 777.00it/s]     24%|##3       | 15460/65536 [00:20<01:04, 776.81it/s]     24%|##3       | 15538/65536 [00:20<01:04, 776.56it/s]     24%|##3       | 15616/65536 [00:20<01:04, 776.39it/s]     24%|##3       | 15694/65536 [00:20<01:04, 776.38it/s]     24%|##4       | 15772/65536 [00:20<01:04, 776.36it/s]     24%|##4       | 15850/65536 [00:20<01:04, 776.29it/s]     24%|##4       | 15929/65536 [00:20<01:03, 778.08it/s]     24%|##4       | 16009/65536 [00:21<01:03, 782.55it/s]     25%|##4       | 16088/65536 [00:21<01:03, 782.02it/s]     25%|##4       | 16168/65536 [00:21<01:02, 785.54it/s]     25%|##4       | 16247/65536 [00:21<01:03, 781.23it/s]     25%|##4       | 16326/65536 [00:21<01:04, 765.32it/s]     25%|##5       | 16403/65536 [00:21<01:04, 759.48it/s]     25%|##5       | 16479/65536 [00:21<01:04, 757.51it/s]     25%|##5       | 16556/65536 [00:21<01:04, 759.77it/s]     25%|##5       | 16633/65536 [00:21<01:04, 761.53it/s]     25%|##5       | 16710/65536 [00:21<01:04, 762.69it/s]     26%|##5       | 16787/65536 [00:22<01:03, 763.68it/s]     26%|##5       | 16865/65536 [00:22<01:03, 767.50it/s]     26%|##5       | 16943/65536 [00:22<01:03, 770.54it/s]     26%|##5       | 17021/65536 [00:22<01:03, 764.67it/s]     26%|##6       | 17099/65536 [00:22<01:03, 767.36it/s]     26%|##6       | 17176/65536 [00:22<01:03, 766.29it/s]     26%|##6       | 17254/65536 [00:22<01:02, 767.76it/s]     26%|##6       | 17332/65536 [00:22<01:02, 768.92it/s]     27%|##6       | 17410/65536 [00:22<01:02, 770.25it/s]     27%|##6       | 17488/65536 [00:22<01:02, 771.06it/s]     27%|##6       | 17566/65536 [00:23<01:02, 769.22it/s]     27%|##6       | 17643/65536 [00:23<01:02, 763.02it/s]     27%|##7       | 17720/65536 [00:23<01:02, 759.94it/s]     27%|##7       | 17797/65536 [00:23<01:02, 757.90it/s]     27%|##7       | 17876/65536 [00:23<01:02, 764.72it/s]     27%|##7       | 17956/65536 [00:23<01:01, 772.74it/s]     28%|##7       | 18036/65536 [00:23<01:00, 779.36it/s]     28%|##7       | 18114/65536 [00:23<01:01, 774.19it/s]     28%|##7       | 18192/65536 [00:23<01:01, 769.01it/s]     28%|##7       | 18269/65536 [00:23<01:01, 763.88it/s]     28%|##7       | 18346/65536 [00:24<01:02, 757.72it/s]     28%|##8       | 18422/65536 [00:24<01:02, 755.31it/s]     28%|##8       | 18499/65536 [00:24<01:02, 756.77it/s]     28%|##8       | 18575/65536 [00:24<01:02, 752.14it/s]     28%|##8       | 18652/65536 [00:24<01:01, 757.12it/s]     29%|##8       | 18729/65536 [00:24<01:01, 759.70it/s]     29%|##8       | 18807/65536 [00:24<01:01, 763.61it/s]     29%|##8       | 18884/65536 [00:24<01:00, 765.25it/s]     29%|##8       | 18963/65536 [00:24<01:00, 772.20it/s]     29%|##9       | 19041/65536 [00:24<01:00, 764.49it/s]     29%|##9       | 19118/65536 [00:25<01:00, 764.21it/s]     29%|##9       | 19196/65536 [00:25<01:00, 767.13it/s]     29%|##9       | 19276/65536 [00:25<00:59, 774.47it/s]     30%|##9       | 19356/65536 [00:25<00:59, 779.89it/s]     30%|##9       | 19435/65536 [00:25<00:58, 782.32it/s]     30%|##9       | 19514/65536 [00:25<00:59, 774.16it/s]     30%|##9       | 19592/65536 [00:25<00:59, 771.10it/s]     30%|###       | 19670/65536 [00:25<00:59, 768.45it/s]     30%|###       | 19748/65536 [00:25<00:59, 769.64it/s]     30%|###       | 19826/65536 [00:26<00:59, 771.61it/s]     30%|###       | 19904/65536 [00:26<00:59, 772.85it/s]     30%|###       | 19982/65536 [00:26<00:58, 773.75it/s]     31%|###       | 20060/65536 [00:26<00:58, 774.22it/s]     31%|###       | 20138/65536 [00:26<00:58, 773.27it/s]     31%|###       | 20218/65536 [00:26<00:58, 779.34it/s]     31%|###       | 20298/65536 [00:26<00:57, 784.00it/s]     31%|###1      | 20378/65536 [00:26<00:57, 786.84it/s]     31%|###1      | 20458/65536 [00:26<00:57, 788.83it/s]     31%|###1      | 20538/65536 [00:26<00:56, 790.01it/s]     31%|###1      | 20618/65536 [00:27<00:56, 790.48it/s]     32%|###1      | 20698/65536 [00:27<00:56, 791.36it/s]     32%|###1      | 20778/65536 [00:27<00:56, 792.08it/s]     32%|###1      | 20858/65536 [00:27<00:56, 792.58it/s]     32%|###1      | 20938/65536 [00:27<00:56, 792.97it/s]     32%|###2      | 21018/65536 [00:27<00:56, 789.60it/s]     32%|###2      | 21097/65536 [00:27<00:57, 778.14it/s]     32%|###2      | 21176/65536 [00:27<00:56, 780.48it/s]     32%|###2      | 21255/65536 [00:27<00:57, 769.27it/s]     33%|###2      | 21333/65536 [00:27<00:57, 769.91it/s]     33%|###2      | 21411/65536 [00:28<00:57, 768.27it/s]     33%|###2      | 21489/65536 [00:28<00:57, 770.09it/s]     33%|###2      | 21567/65536 [00:28<00:56, 772.88it/s]     33%|###3      | 21645/65536 [00:28<00:56, 770.65it/s]     33%|###3      | 21723/65536 [00:28<00:56, 770.64it/s]     33%|###3      | 21801/65536 [00:28<00:56, 769.50it/s]     33%|###3      | 21878/65536 [00:28<00:56, 767.75it/s]     34%|###3      | 21955/65536 [00:28<00:57, 764.14it/s]     34%|###3      | 22032/65536 [00:28<00:56, 765.22it/s]     34%|###3      | 22109/65536 [00:28<00:57, 756.72it/s]     34%|###3      | 22185/65536 [00:29<00:57, 748.40it/s]     34%|###3      | 22260/65536 [00:29<00:57, 746.75it/s]     34%|###4      | 22335/65536 [00:29<00:57, 745.03it/s]     34%|###4      | 22410/65536 [00:29<00:57, 744.01it/s]     34%|###4      | 22486/65536 [00:29<00:57, 746.59it/s]     34%|###4      | 22562/65536 [00:29<00:57, 747.57it/s]     35%|###4      | 22637/65536 [00:29<00:59, 721.89it/s]     35%|###4      | 22710/65536 [00:29<00:59, 721.15it/s]     35%|###4      | 22783/65536 [00:29<00:59, 723.16it/s]     35%|###4      | 22858/65536 [00:29<00:58, 729.10it/s]     35%|###4      | 22934/65536 [00:30<00:57, 735.89it/s]     35%|###5      | 23010/65536 [00:30<00:57, 740.33it/s]     35%|###5      | 23086/65536 [00:30<00:57, 744.69it/s]     35%|###5      | 23162/65536 [00:30<00:56, 747.56it/s]     35%|###5      | 23240/65536 [00:30<00:56, 754.52it/s]     36%|###5      | 23316/65536 [00:30<00:55, 755.68it/s]     36%|###5      | 23395/65536 [00:30<00:55, 763.28it/s]     36%|###5      | 23472/65536 [00:30<00:55, 763.52it/s]     36%|###5      | 23549/65536 [00:30<00:54, 764.58it/s]     36%|###6      | 23626/65536 [00:30<00:54, 763.29it/s]     36%|###6      | 23703/65536 [00:31<00:54, 763.84it/s]     36%|###6      | 23780/65536 [00:31<00:54, 762.03it/s]     36%|###6      | 23857/65536 [00:31<00:54, 762.95it/s]     37%|###6      | 23935/65536 [00:31<00:54, 766.41it/s]     37%|###6      | 24012/65536 [00:31<00:54, 767.06it/s]     37%|###6      | 24089/65536 [00:31<00:54, 765.62it/s]     37%|###6      | 24166/65536 [00:31<00:58, 710.01it/s]     37%|###6      | 24242/65536 [00:31<00:57, 721.54it/s]     37%|###7      | 24318/65536 [00:31<00:56, 730.28it/s]     37%|###7      | 24395/65536 [00:32<00:55, 739.42it/s]     37%|###7      | 24472/65536 [00:32<00:54, 747.26it/s]     37%|###7      | 24548/65536 [00:32<00:54, 750.42it/s]     38%|###7      | 24626/65536 [00:32<00:53, 758.06it/s]     38%|###7      | 24705/65536 [00:32<00:53, 766.46it/s]     38%|###7      | 24782/65536 [00:32<00:53, 764.88it/s]     38%|###7      | 24859/65536 [00:32<00:53, 763.42it/s]     38%|###8      | 24936/65536 [00:32<00:53, 759.56it/s]     38%|###8      | 25012/65536 [00:32<00:53, 759.65it/s]     38%|###8      | 25089/65536 [00:32<00:53, 762.08it/s]     38%|###8      | 25166/65536 [00:33<00:52, 763.89it/s]     39%|###8      | 25243/65536 [00:33<00:52, 764.68it/s]     39%|###8      | 25320/65536 [00:33<00:52, 762.41it/s]     39%|###8      | 25397/65536 [00:33<00:52, 758.70it/s]     39%|###8      | 25473/65536 [00:33<00:52, 756.34it/s]     39%|###8      | 25549/65536 [00:33<00:52, 756.82it/s]     39%|###9      | 25625/65536 [00:33<00:52, 756.68it/s]     39%|###9      | 25701/65536 [00:33<00:52, 757.57it/s]     39%|###9      | 25778/65536 [00:33<00:52, 759.38it/s]     39%|###9      | 25856/65536 [00:33<00:51, 764.53it/s]     40%|###9      | 25936/65536 [00:34<00:51, 772.38it/s]     40%|###9      | 26014/65536 [00:34<00:51, 771.10it/s]     40%|###9      | 26092/65536 [00:34<00:51, 767.77it/s]     40%|###9      | 26169/65536 [00:34<00:51, 763.14it/s]     40%|####      | 26246/65536 [00:34<00:51, 760.51it/s]     40%|####      | 26323/65536 [00:34<00:51, 757.98it/s]     40%|####      | 26399/65536 [00:34<00:51, 757.51it/s]     40%|####      | 26477/65536 [00:34<00:51, 761.40it/s]     41%|####      | 26554/65536 [00:34<00:51, 760.29it/s]     41%|####      | 26631/65536 [00:34<00:51, 759.72it/s]     41%|####      | 26707/65536 [00:35<00:51, 753.67it/s]     41%|####      | 26783/65536 [00:35<00:51, 751.93it/s]     41%|####      | 26859/65536 [00:35<00:51, 753.99it/s]     41%|####1     | 26935/65536 [00:35<00:51, 752.45it/s]     41%|####1     | 27011/65536 [00:35<00:51, 752.79it/s]     41%|####1     | 27087/65536 [00:35<00:51, 750.41it/s]     41%|####1     | 27164/65536 [00:35<00:50, 755.26it/s]     42%|####1     | 27240/65536 [00:35<00:50, 755.09it/s]     42%|####1     | 27316/65536 [00:35<00:51, 748.06it/s]     42%|####1     | 27391/65536 [00:35<00:51, 744.85it/s]     42%|####1     | 27467/65536 [00:36<00:50, 746.49it/s]     42%|####2     | 27543/65536 [00:36<00:50, 748.35it/s]     42%|####2     | 27620/65536 [00:36<00:50, 754.36it/s]     42%|####2     | 27697/65536 [00:36<00:49, 758.37it/s]     42%|####2     | 27774/65536 [00:36<00:49, 759.20it/s]     42%|####2     | 27850/65536 [00:36<00:49, 758.45it/s]     43%|####2     | 27926/65536 [00:36<00:49, 757.77it/s]     43%|####2     | 28002/65536 [00:36<00:49, 756.54it/s]     43%|####2     | 28078/65536 [00:36<00:49, 754.54it/s]     43%|####2     | 28154/65536 [00:36<00:49, 753.10it/s]     43%|####3     | 28230/65536 [00:37<00:49, 751.25it/s]     43%|####3     | 28306/65536 [00:37<00:49, 749.88it/s]     43%|####3     | 28382/65536 [00:37<00:49, 751.48it/s]     43%|####3     | 28458/65536 [00:37<00:49, 751.75it/s]     44%|####3     | 28534/65536 [00:37<00:49, 751.36it/s]     44%|####3     | 28610/65536 [00:37<00:48, 753.71it/s]     44%|####3     | 28686/65536 [00:37<00:48, 752.80it/s]     44%|####3     | 28762/65536 [00:37<00:48, 750.72it/s]     44%|####4     | 28838/65536 [00:37<00:48, 751.14it/s]     44%|####4     | 28917/65536 [00:37<00:48, 762.12it/s]     44%|####4     | 28994/65536 [00:38<00:47, 763.24it/s]     44%|####4     | 29071/65536 [00:38<00:47, 762.71it/s]     44%|####4     | 29148/65536 [00:38<00:48, 757.94it/s]     45%|####4     | 29226/65536 [00:38<00:47, 762.52it/s]     45%|####4     | 29304/65536 [00:38<00:47, 766.56it/s]     45%|####4     | 29381/65536 [00:38<00:47, 763.85it/s]     45%|####4     | 29458/65536 [00:38<00:47, 756.00it/s]     45%|####5     | 29535/65536 [00:38<00:47, 758.77it/s]     45%|####5     | 29611/65536 [00:38<00:47, 755.48it/s]     45%|####5     | 29688/65536 [00:38<00:47, 759.18it/s]     45%|####5     | 29764/65536 [00:39<00:47, 755.19it/s]     46%|####5     | 29840/65536 [00:39<00:47, 753.21it/s]     46%|####5     | 29916/65536 [00:39<00:47, 749.63it/s]     46%|####5     | 29991/65536 [00:39<00:48, 731.50it/s]     46%|####5     | 30068/65536 [00:39<00:47, 741.46it/s]     46%|####5     | 30143/65536 [00:39<00:47, 743.74it/s]     46%|####6     | 30218/65536 [00:39<00:47, 743.73it/s]     46%|####6     | 30293/65536 [00:39<00:47, 744.25it/s]     46%|####6     | 30368/65536 [00:39<00:47, 745.47it/s]     46%|####6     | 30444/65536 [00:40<00:46, 748.81it/s]     47%|####6     | 30521/65536 [00:40<00:46, 754.02it/s]     47%|####6     | 30598/65536 [00:40<00:46, 757.74it/s]     47%|####6     | 30675/65536 [00:40<00:45, 759.79it/s]     47%|####6     | 30753/65536 [00:40<00:45, 762.91it/s]     47%|####7     | 30831/65536 [00:40<00:45, 765.65it/s]     47%|####7     | 30909/65536 [00:40<00:45, 767.53it/s]     47%|####7     | 30987/65536 [00:40<00:44, 769.26it/s]     47%|####7     | 31065/65536 [00:40<00:44, 770.12it/s]     48%|####7     | 31143/65536 [00:40<00:44, 769.62it/s]     48%|####7     | 31220/65536 [00:41<00:45, 746.04it/s]     48%|####7     | 31296/65536 [00:41<00:45, 747.45it/s]     48%|####7     | 31371/65536 [00:41<00:45, 745.17it/s]     48%|####7     | 31448/65536 [00:41<00:45, 749.82it/s]     48%|####8     | 31524/65536 [00:41<00:45, 752.71it/s]     48%|####8     | 31602/65536 [00:41<00:44, 759.59it/s]     48%|####8     | 31678/65536 [00:41<00:44, 754.88it/s]     48%|####8     | 31754/65536 [00:41<00:44, 755.80it/s]     49%|####8     | 31830/65536 [00:41<00:44, 755.47it/s]     49%|####8     | 31906/65536 [00:41<00:44, 756.71it/s]     49%|####8     | 31982/65536 [00:42<00:44, 750.18it/s]     49%|####8     | 32058/65536 [00:42<00:44, 749.92it/s]     49%|####9     | 32135/65536 [00:42<00:44, 754.64it/s]     49%|####9     | 32212/65536 [00:42<00:43, 758.72it/s]     49%|####9     | 32290/65536 [00:42<00:43, 762.68it/s]     49%|####9     | 32368/65536 [00:42<00:43, 765.24it/s]     50%|####9     | 32445/65536 [00:42<00:43, 765.68it/s]     50%|####9     | 32522/65536 [00:42<00:43, 759.55it/s]     50%|####9     | 32598/65536 [00:42<00:43, 759.17it/s]     50%|####9     | 32675/65536 [00:42<00:43, 762.14it/s]     50%|####9     | 32752/65536 [00:43<00:43, 762.34it/s]     50%|#####     | 32829/65536 [00:43<00:43, 759.21it/s]     50%|#####     | 32905/65536 [00:43<00:43, 758.78it/s]     50%|#####     | 32982/65536 [00:43<00:42, 760.10it/s]     50%|#####     | 33060/65536 [00:43<00:42, 764.95it/s]     51%|#####     | 33140/65536 [00:43<00:41, 772.64it/s]     51%|#####     | 33218/65536 [00:43<00:41, 774.04it/s]     51%|#####     | 33296/65536 [00:43<00:41, 773.36it/s]     51%|#####     | 33374/65536 [00:43<00:41, 775.04it/s]     51%|#####1    | 33452/65536 [00:43<00:41, 775.06it/s]     51%|#####1    | 33530/65536 [00:44<00:41, 774.73it/s]     51%|#####1    | 33608/65536 [00:44<00:41, 774.36it/s]     51%|#####1    | 33686/65536 [00:44<00:41, 773.85it/s]     52%|#####1    | 33764/65536 [00:44<00:41, 766.99it/s]     52%|#####1    | 33842/65536 [00:44<00:41, 768.44it/s]     52%|#####1    | 33919/65536 [00:44<00:41, 764.74it/s]     52%|#####1    | 33996/65536 [00:44<00:41, 758.67it/s]     52%|#####1    | 34072/65536 [00:44<00:41, 756.01it/s]     52%|#####2    | 34148/65536 [00:44<00:41, 755.20it/s]     52%|#####2    | 34224/65536 [00:44<00:41, 756.56it/s]     52%|#####2    | 34300/65536 [00:45<00:41, 756.23it/s]     52%|#####2    | 34377/65536 [00:45<00:41, 758.68it/s]     53%|#####2    | 34454/65536 [00:45<00:40, 760.86it/s]     53%|#####2    | 34532/65536 [00:45<00:40, 764.09it/s]     53%|#####2    | 34609/65536 [00:45<00:40, 762.57it/s]     53%|#####2    | 34686/65536 [00:45<00:40, 761.08it/s]     53%|#####3    | 34763/65536 [00:45<00:40, 763.53it/s]     53%|#####3    | 34841/65536 [00:45<00:40, 766.46it/s]     53%|#####3    | 34918/65536 [00:45<00:40, 764.14it/s]     53%|#####3    | 34998/65536 [00:45<00:39, 772.49it/s]     54%|#####3    | 35076/65536 [00:46<00:39, 768.85it/s]     54%|#####3    | 35153/65536 [00:46<00:41, 733.80it/s]     54%|#####3    | 35231/65536 [00:46<00:40, 745.40it/s]     54%|#####3    | 35307/65536 [00:46<00:40, 749.08it/s]     54%|#####3    | 35385/65536 [00:46<00:39, 757.13it/s]     54%|#####4    | 35463/65536 [00:46<00:39, 762.74it/s]     54%|#####4    | 35541/65536 [00:46<00:39, 765.90it/s]     54%|#####4    | 35619/65536 [00:46<00:38, 768.63it/s]     54%|#####4    | 35697/65536 [00:46<00:38, 770.90it/s]     55%|#####4    | 35775/65536 [00:47<00:38, 772.80it/s]     55%|#####4    | 35853/65536 [00:47<00:38, 772.66it/s]     55%|#####4    | 35931/65536 [00:47<00:38, 769.39it/s]     55%|#####4    | 36009/65536 [00:47<00:38, 770.21it/s]     55%|#####5    | 36087/65536 [00:47<00:38, 771.03it/s]     55%|#####5    | 36165/65536 [00:47<00:38, 768.35it/s]     55%|#####5    | 36242/65536 [00:47<00:38, 765.14it/s]     55%|#####5    | 36319/65536 [00:47<00:38, 765.96it/s]     56%|#####5    | 36397/65536 [00:47<00:37, 768.52it/s]     56%|#####5    | 36475/65536 [00:47<00:37, 769.45it/s]     56%|#####5    | 36553/65536 [00:48<00:37, 770.19it/s]     56%|#####5    | 36631/65536 [00:48<00:37, 770.05it/s]     56%|#####6    | 36709/65536 [00:48<00:37, 770.89it/s]     56%|#####6    | 36787/65536 [00:48<00:37, 771.81it/s]     56%|#####6    | 36865/65536 [00:48<00:37, 771.88it/s]     56%|#####6    | 36943/65536 [00:48<00:37, 772.74it/s]     56%|#####6    | 37021/65536 [00:48<00:36, 771.35it/s]     57%|#####6    | 37099/65536 [00:48<00:36, 770.95it/s]     57%|#####6    | 37177/65536 [00:48<00:36, 771.95it/s]     57%|#####6    | 37256/65536 [00:48<00:36, 775.39it/s]     57%|#####6    | 37334/65536 [00:49<00:36, 775.51it/s]     57%|#####7    | 37412/65536 [00:49<00:36, 773.95it/s]     57%|#####7    | 37490/65536 [00:49<00:36, 764.09it/s]     57%|#####7    | 37567/65536 [00:49<00:37, 754.28it/s]     57%|#####7    | 37643/65536 [00:49<00:36, 754.15it/s]     58%|#####7    | 37719/65536 [00:49<00:36, 754.95it/s]     58%|#####7    | 37795/65536 [00:49<00:36, 754.60it/s]     58%|#####7    | 37871/65536 [00:49<00:36, 753.66it/s]     58%|#####7    | 37947/65536 [00:49<00:36, 748.25it/s]     58%|#####8    | 38022/65536 [00:49<00:36, 747.85it/s]     58%|#####8    | 38098/65536 [00:50<00:36, 750.69it/s]     58%|#####8    | 38174/65536 [00:50<00:36, 749.21it/s]     58%|#####8    | 38250/65536 [00:50<00:36, 751.93it/s]     58%|#####8    | 38328/65536 [00:50<00:35, 758.61it/s]     59%|#####8    | 38405/65536 [00:50<00:35, 760.06it/s]     59%|#####8    | 38482/65536 [00:50<00:35, 755.21it/s]     59%|#####8    | 38558/65536 [00:50<00:35, 753.11it/s]     59%|#####8    | 38634/65536 [00:50<00:35, 751.27it/s]     59%|#####9    | 38710/65536 [00:50<00:35, 747.48it/s]     59%|#####9    | 38785/65536 [00:50<00:35, 745.87it/s]     59%|#####9    | 38861/65536 [00:51<00:35, 747.93it/s]     59%|#####9    | 38937/65536 [00:51<00:35, 749.55it/s]     60%|#####9    | 39013/65536 [00:51<00:35, 751.18it/s]     60%|#####9    | 39091/65536 [00:51<00:34, 758.06it/s]     60%|#####9    | 39169/65536 [00:51<00:34, 762.18it/s]     60%|#####9    | 39246/65536 [00:51<00:34, 763.85it/s]     60%|######    | 39323/65536 [00:51<00:34, 760.71it/s]     60%|######    | 39400/65536 [00:51<00:34, 760.74it/s]     60%|######    | 39477/65536 [00:51<00:34, 760.49it/s]     60%|######    | 39554/65536 [00:51<00:34, 747.56it/s]     60%|######    | 39629/65536 [00:52<00:34, 742.06it/s]     61%|######    | 39704/65536 [00:52<00:34, 741.84it/s]     61%|######    | 39779/65536 [00:52<00:34, 738.24it/s]     61%|######    | 39854/65536 [00:52<00:34, 740.28it/s]     61%|######    | 39931/65536 [00:52<00:34, 746.78it/s]     61%|######1   | 40008/65536 [00:52<00:33, 752.28it/s]     61%|######1   | 40084/65536 [00:52<00:33, 752.89it/s]     61%|######1   | 40162/65536 [00:52<00:33, 758.55it/s]     61%|######1   | 40240/65536 [00:52<00:33, 763.01it/s]     62%|######1   | 40318/65536 [00:52<00:32, 765.92it/s]     62%|######1   | 40395/65536 [00:53<00:32, 763.57it/s]     62%|######1   | 40472/65536 [00:53<00:32, 760.61it/s]     62%|######1   | 40549/65536 [00:53<00:32, 758.54it/s]     62%|######1   | 40625/65536 [00:53<00:32, 755.49it/s]     62%|######2   | 40701/65536 [00:53<00:32, 754.38it/s]     62%|######2   | 40777/65536 [00:53<00:32, 753.25it/s]     62%|######2   | 40853/65536 [00:53<00:32, 754.79it/s]     62%|######2   | 40929/65536 [00:53<00:32, 754.90it/s]     63%|######2   | 41006/65536 [00:53<00:32, 757.38it/s]     63%|######2   | 41084/65536 [00:54<00:32, 761.71it/s]     63%|######2   | 41161/65536 [00:54<00:31, 763.45it/s]     63%|######2   | 41238/65536 [00:54<00:31, 760.03it/s]     63%|######3   | 41315/65536 [00:54<00:32, 756.56it/s]     63%|######3   | 41391/65536 [00:54<00:32, 753.51it/s]     63%|######3   | 41467/65536 [00:54<00:32, 751.14it/s]     63%|######3   | 41544/65536 [00:54<00:31, 756.25it/s]     64%|######3   | 41621/65536 [00:54<00:31, 759.36it/s]     64%|######3   | 41697/65536 [00:54<00:32, 740.75it/s]     64%|######3   | 41774/65536 [00:54<00:31, 748.77it/s]     64%|######3   | 41850/65536 [00:55<00:31, 751.43it/s]     64%|######3   | 41926/65536 [00:55<00:31, 752.08it/s]     64%|######4   | 42004/65536 [00:55<00:30, 759.22it/s]     64%|######4   | 42080/65536 [00:55<00:31, 755.39it/s]     64%|######4   | 42156/65536 [00:55<00:31, 754.11it/s]     64%|######4   | 42233/65536 [00:55<00:30, 756.06it/s]     65%|######4   | 42309/65536 [00:55<00:30, 757.04it/s]     65%|######4   | 42386/65536 [00:55<00:30, 760.41it/s]     65%|######4   | 42465/65536 [00:55<00:30, 767.14it/s]     65%|######4   | 42545/65536 [00:55<00:29, 774.48it/s]     65%|######5   | 42625/65536 [00:56<00:29, 779.99it/s]     65%|######5   | 42705/65536 [00:56<00:29, 783.55it/s]     65%|######5   | 42785/65536 [00:56<00:28, 786.29it/s]     65%|######5   | 42864/65536 [00:56<00:28, 785.70it/s]     66%|######5   | 42943/65536 [00:56<00:28, 780.53it/s]     66%|######5   | 43022/65536 [00:56<00:28, 776.74it/s]     66%|######5   | 43100/65536 [00:56<00:28, 774.43it/s]     66%|######5   | 43178/65536 [00:56<00:28, 773.22it/s]     66%|######6   | 43256/65536 [00:56<00:28, 772.77it/s]     66%|######6   | 43334/65536 [00:56<00:28, 772.57it/s]     66%|######6   | 43412/65536 [00:57<00:28, 772.81it/s]     66%|######6   | 43490/65536 [00:57<00:28, 769.83it/s]     66%|######6   | 43568/65536 [00:57<00:28, 771.69it/s]     67%|######6   | 43647/65536 [00:57<00:28, 774.21it/s]     67%|######6   | 43725/65536 [00:57<00:28, 775.04it/s]     67%|######6   | 43803/65536 [00:57<00:28, 775.53it/s]     67%|######6   | 43881/65536 [00:57<00:27, 775.74it/s]     67%|######7   | 43959/65536 [00:57<00:27, 775.77it/s]     67%|######7   | 44037/65536 [00:57<00:27, 775.69it/s]     67%|######7   | 44115/65536 [00:57<00:27, 775.55it/s]     67%|######7   | 44193/65536 [00:58<00:27, 776.09it/s]     68%|######7   | 44271/65536 [00:58<00:27, 776.03it/s]     68%|######7   | 44349/65536 [00:58<00:27, 775.84it/s]     68%|######7   | 44427/65536 [00:58<00:27, 775.94it/s]     68%|######7   | 44507/65536 [00:58<00:26, 780.87it/s]     68%|######8   | 44587/65536 [00:58<00:26, 784.02it/s]     68%|######8   | 44666/65536 [00:58<00:26, 782.54it/s]     68%|######8   | 44746/65536 [00:58<00:26, 785.00it/s]     68%|######8   | 44825/65536 [00:58<00:26, 784.68it/s]     69%|######8   | 44904/65536 [00:58<00:26, 785.86it/s]     69%|######8   | 44983/65536 [00:59<00:26, 786.70it/s]     69%|######8   | 45062/65536 [00:59<00:26, 782.81it/s]     69%|######8   | 45141/65536 [00:59<00:26, 771.65it/s]     69%|######8   | 45219/65536 [00:59<00:26, 765.22it/s]     69%|######9   | 45296/65536 [00:59<00:26, 763.07it/s]     69%|######9   | 45373/65536 [00:59<00:26, 761.47it/s]     69%|######9   | 45450/65536 [00:59<00:26, 758.89it/s]     69%|######9   | 45527/65536 [00:59<00:26, 759.96it/s]     70%|######9   | 45604/65536 [00:59<00:26, 761.80it/s]     70%|######9   | 45681/65536 [00:59<00:26, 759.89it/s]     70%|######9   | 45758/65536 [01:00<00:26, 760.35it/s]     70%|######9   | 45836/65536 [01:00<00:25, 763.80it/s]     70%|#######   | 45914/65536 [01:00<00:25, 765.68it/s]     70%|#######   | 45991/65536 [01:00<00:25, 766.87it/s]     70%|#######   | 46069/65536 [01:00<00:25, 768.29it/s]     70%|#######   | 46147/65536 [01:00<00:25, 769.18it/s]     71%|#######   | 46224/65536 [01:00<00:25, 768.36it/s]     71%|#######   | 46301/65536 [01:00<00:25, 767.98it/s]     71%|#######   | 46378/65536 [01:00<00:25, 763.23it/s]     71%|#######   | 46455/65536 [01:00<00:25, 757.58it/s]     71%|#######1  | 46531/65536 [01:01<00:25, 740.89it/s]     71%|#######1  | 46607/65536 [01:01<00:25, 745.68it/s]     71%|#######1  | 46682/65536 [01:01<00:25, 746.41it/s]     71%|#######1  | 46759/65536 [01:01<00:24, 753.09it/s]     71%|#######1  | 46835/65536 [01:01<00:24, 753.32it/s]     72%|#######1  | 46911/65536 [01:01<00:24, 754.53it/s]     72%|#######1  | 46987/65536 [01:01<00:24, 755.78it/s]     72%|#######1  | 47065/65536 [01:01<00:24, 761.49it/s]     72%|#######1  | 47142/65536 [01:01<00:24, 761.75it/s]     72%|#######2  | 47220/65536 [01:02<00:23, 764.73it/s]     72%|#######2  | 47297/65536 [01:02<00:23, 761.32it/s]     72%|#######2  | 47374/65536 [01:02<00:23, 758.28it/s]     72%|#######2  | 47450/65536 [01:02<00:23, 753.88it/s]     73%|#######2  | 47526/65536 [01:02<00:23, 753.65it/s]     73%|#######2  | 47602/65536 [01:02<00:23, 752.54it/s]     73%|#######2  | 47678/65536 [01:02<00:23, 747.98it/s]     73%|#######2  | 47753/65536 [01:02<00:23, 747.44it/s]     73%|#######2  | 47828/65536 [01:02<00:23, 747.20it/s]     73%|#######3  | 47903/65536 [01:02<00:23, 747.13it/s]     73%|#######3  | 47981/65536 [01:03<00:23, 754.40it/s]     73%|#######3  | 48058/65536 [01:03<00:23, 756.85it/s]     73%|#######3  | 48134/65536 [01:03<00:23, 755.99it/s]     74%|#######3  | 48211/65536 [01:03<00:22, 759.80it/s]     74%|#######3  | 48289/65536 [01:03<00:22, 764.69it/s]     74%|#######3  | 48367/65536 [01:03<00:22, 767.23it/s]     74%|#######3  | 48444/65536 [01:03<00:22, 763.50it/s]     74%|#######4  | 48521/65536 [01:03<00:22, 764.25it/s]     74%|#######4  | 48598/65536 [01:03<00:22, 760.18it/s]     74%|#######4  | 48675/65536 [01:03<00:22, 755.14it/s]     74%|#######4  | 48752/65536 [01:04<00:22, 757.11it/s]     75%|#######4  | 48828/65536 [01:04<00:22, 757.63it/s]     75%|#######4  | 48904/65536 [01:04<00:21, 757.39it/s]     75%|#######4  | 48983/65536 [01:04<00:21, 766.96it/s]     75%|#######4  | 49063/65536 [01:04<00:21, 774.39it/s]     75%|#######4  | 49143/65536 [01:04<00:21, 779.69it/s]     75%|#######5  | 49222/65536 [01:04<00:20, 780.03it/s]     75%|#######5  | 49301/65536 [01:04<00:20, 775.90it/s]     75%|#######5  | 49379/65536 [01:04<00:20, 773.86it/s]     75%|#######5  | 49457/65536 [01:04<00:20, 770.59it/s]     76%|#######5  | 49535/65536 [01:05<00:20, 764.61it/s]     76%|#######5  | 49612/65536 [01:05<00:20, 759.13it/s]     76%|#######5  | 49688/65536 [01:05<00:20, 755.78it/s]     76%|#######5  | 49764/65536 [01:05<00:20, 752.67it/s]     76%|#######6  | 49840/65536 [01:05<00:21, 744.09it/s]     76%|#######6  | 49915/65536 [01:05<00:21, 730.51it/s]     76%|#######6  | 49991/65536 [01:05<00:21, 737.94it/s]     76%|#######6  | 50066/65536 [01:05<00:20, 738.92it/s]     77%|#######6  | 50141/65536 [01:05<00:20, 740.73it/s]     77%|#######6  | 50216/65536 [01:05<00:20, 741.69it/s]     77%|#######6  | 50291/65536 [01:06<00:20, 742.78it/s]     77%|#######6  | 50366/65536 [01:06<00:20, 743.92it/s]     77%|#######6  | 50442/65536 [01:06<00:20, 745.94it/s]     77%|#######7  | 50517/65536 [01:06<00:20, 739.70it/s]     77%|#######7  | 50592/65536 [01:06<00:20, 740.93it/s]     77%|#######7  | 50667/65536 [01:06<00:20, 742.29it/s]     77%|#######7  | 50743/65536 [01:06<00:19, 745.35it/s]     78%|#######7  | 50819/65536 [01:06<00:19, 747.29it/s]     78%|#######7  | 50894/65536 [01:06<00:19, 748.06it/s]     78%|#######7  | 50969/65536 [01:06<00:19, 748.53it/s]     78%|#######7  | 51045/65536 [01:07<00:19, 749.83it/s]     78%|#######8  | 51123/65536 [01:07<00:19, 757.50it/s]     78%|#######8  | 51200/65536 [01:07<00:18, 759.18it/s]     78%|#######8  | 51277/65536 [01:07<00:18, 760.85it/s]     78%|#######8  | 51354/65536 [01:07<00:18, 757.10it/s]     78%|#######8  | 51431/65536 [01:07<00:18, 758.40it/s]     79%|#######8  | 51507/65536 [01:07<00:18, 753.26it/s]     79%|#######8  | 51583/65536 [01:07<00:18, 753.41it/s]     79%|#######8  | 51660/65536 [01:07<00:18, 755.75it/s]     79%|#######8  | 51737/65536 [01:07<00:18, 759.15it/s]     79%|#######9  | 51813/65536 [01:08<00:18, 756.67it/s]     79%|#######9  | 51889/65536 [01:08<00:18, 756.22it/s]     79%|#######9  | 51968/65536 [01:08<00:17, 765.09it/s]     79%|#######9  | 52045/65536 [01:08<00:18, 733.89it/s]     80%|#######9  | 52120/65536 [01:08<00:18, 737.21it/s]     80%|#######9  | 52196/65536 [01:08<00:17, 741.64it/s]     80%|#######9  | 52271/65536 [01:08<00:17, 738.35it/s]     80%|#######9  | 52348/65536 [01:08<00:17, 746.76it/s]     80%|#######9  | 52423/65536 [01:08<00:17, 747.55it/s]     80%|########  | 52500/65536 [01:09<00:17, 752.79it/s]     80%|########  | 52576/65536 [01:09<00:17, 751.99it/s]     80%|########  | 52652/65536 [01:09<00:17, 751.73it/s]     80%|########  | 52728/65536 [01:09<00:16, 754.08it/s]     81%|########  | 52806/65536 [01:09<00:16, 760.36it/s]     81%|########  | 52884/65536 [01:09<00:16, 763.35it/s]     81%|########  | 52961/65536 [01:09<00:16, 763.76it/s]     81%|########  | 53038/65536 [01:09<00:16, 761.93it/s]     81%|########1 | 53115/65536 [01:09<00:16, 760.59it/s]     81%|########1 | 53192/65536 [01:09<00:16, 757.43it/s]     81%|########1 | 53268/65536 [01:10<00:16, 756.18it/s]     81%|########1 | 53344/65536 [01:10<00:16, 751.36it/s]     82%|########1 | 53420/65536 [01:10<00:16, 744.41it/s]     82%|########1 | 53495/65536 [01:10<00:16, 729.30it/s]     82%|########1 | 53571/65536 [01:10<00:16, 737.69it/s]     82%|########1 | 53647/65536 [01:10<00:15, 743.71it/s]     82%|########1 | 53722/65536 [01:10<00:15, 744.59it/s]     82%|########2 | 53797/65536 [01:10<00:15, 746.03it/s]     82%|########2 | 53873/65536 [01:10<00:15, 747.42it/s]     82%|########2 | 53948/65536 [01:10<00:15, 746.41it/s]     82%|########2 | 54023/65536 [01:11<00:15, 744.80it/s]     83%|########2 | 54098/65536 [01:11<00:15, 746.23it/s]     83%|########2 | 54174/65536 [01:11<00:15, 749.12it/s]     83%|########2 | 54251/65536 [01:11<00:14, 753.45it/s]     83%|########2 | 54328/65536 [01:11<00:14, 755.50it/s]     83%|########3 | 54404/65536 [01:11<00:14, 752.74it/s]     83%|########3 | 54480/65536 [01:11<00:14, 737.17it/s]     83%|########3 | 54556/65536 [01:11<00:14, 741.39it/s]     83%|########3 | 54631/65536 [01:11<00:14, 738.45it/s]     83%|########3 | 54707/65536 [01:11<00:14, 742.36it/s]     84%|########3 | 54783/65536 [01:12<00:14, 745.75it/s]     84%|########3 | 54859/65536 [01:12<00:14, 747.22it/s]     84%|########3 | 54935/65536 [01:12<00:14, 748.80it/s]     84%|########3 | 55011/65536 [01:12<00:14, 750.24it/s]     84%|########4 | 55089/65536 [01:12<00:13, 757.22it/s]     84%|########4 | 55168/65536 [01:12<00:13, 766.64it/s]     84%|########4 | 55246/65536 [01:12<00:13, 768.87it/s]     84%|########4 | 55323/65536 [01:12<00:13, 762.62it/s]     85%|########4 | 55400/65536 [01:12<00:13, 759.33it/s]     85%|########4 | 55477/65536 [01:12<00:13, 759.86it/s]     85%|########4 | 55554/65536 [01:13<00:13, 760.05it/s]     85%|########4 | 55631/65536 [01:13<00:13, 753.79it/s]     85%|########5 | 55707/65536 [01:13<00:13, 736.68it/s]     85%|########5 | 55783/65536 [01:13<00:13, 740.65it/s]     85%|########5 | 55858/65536 [01:13<00:13, 739.42it/s]     85%|########5 | 55934/65536 [01:13<00:12, 744.69it/s]     85%|########5 | 56012/65536 [01:13<00:12, 752.54it/s]     86%|########5 | 56088/65536 [01:13<00:12, 754.03it/s]     86%|########5 | 56164/65536 [01:13<00:12, 752.07it/s]     86%|########5 | 56240/65536 [01:13<00:12, 752.74it/s]     86%|########5 | 56318/65536 [01:14<00:12, 760.06it/s]     86%|########6 | 56396/65536 [01:14<00:11, 764.89it/s]     86%|########6 | 56473/65536 [01:14<00:11, 761.05it/s]     86%|########6 | 56550/65536 [01:14<00:11, 756.33it/s]     86%|########6 | 56626/65536 [01:14<00:11, 754.80it/s]     87%|########6 | 56702/65536 [01:14<00:11, 749.63it/s]     87%|########6 | 56777/65536 [01:14<00:11, 747.92it/s]     87%|########6 | 56852/65536 [01:14<00:11, 745.07it/s]     87%|########6 | 56927/65536 [01:14<00:11, 743.26it/s]     87%|########6 | 57002/65536 [01:15<00:11, 739.03it/s]     87%|########7 | 57076/65536 [01:15<00:11, 737.65it/s]     87%|########7 | 57152/65536 [01:15<00:11, 741.61it/s]     87%|########7 | 57228/65536 [01:15<00:11, 745.50it/s]     87%|########7 | 57303/65536 [01:15<00:11, 745.91it/s]     88%|########7 | 57379/65536 [01:15<00:10, 747.40it/s]     88%|########7 | 57456/65536 [01:15<00:10, 752.80it/s]     88%|########7 | 57534/65536 [01:15<00:10, 758.61it/s]     88%|########7 | 57612/65536 [01:15<00:10, 763.45it/s]     88%|########8 | 57692/65536 [01:15<00:10, 771.98it/s]     88%|########8 | 57772/65536 [01:16<00:09, 778.30it/s]     88%|########8 | 57852/65536 [01:16<00:09, 782.19it/s]     88%|########8 | 57931/65536 [01:16<00:09, 781.38it/s]     89%|########8 | 58010/65536 [01:16<00:09, 779.23it/s]     89%|########8 | 58088/65536 [01:16<00:09, 776.01it/s]     89%|########8 | 58167/65536 [01:16<00:09, 777.24it/s]     89%|########8 | 58245/65536 [01:16<00:09, 766.94it/s]     89%|########8 | 58322/65536 [01:16<00:09, 761.02it/s]     89%|########9 | 58399/65536 [01:16<00:09, 756.29it/s]     89%|########9 | 58475/65536 [01:16<00:09, 753.94it/s]     89%|########9 | 58551/65536 [01:17<00:09, 754.62it/s]     89%|########9 | 58627/65536 [01:17<00:09, 753.81it/s]     90%|########9 | 58703/65536 [01:17<00:09, 752.62it/s]     90%|########9 | 58779/65536 [01:17<00:09, 748.40it/s]     90%|########9 | 58856/65536 [01:17<00:08, 752.09it/s]     90%|########9 | 58932/65536 [01:17<00:08, 751.43it/s]     90%|######### | 59008/65536 [01:17<00:08, 750.12it/s]     90%|######### | 59084/65536 [01:17<00:08, 750.20it/s]     90%|######### | 59160/65536 [01:17<00:08, 751.27it/s]     90%|######### | 59236/65536 [01:17<00:08, 749.75it/s]     91%|######### | 59312/65536 [01:18<00:08, 750.33it/s]     91%|######### | 59388/65536 [01:18<00:08, 750.74it/s]     91%|######### | 59466/65536 [01:18<00:08, 757.19it/s]     91%|######### | 59543/65536 [01:18<00:07, 759.98it/s]     91%|######### | 59620/65536 [01:18<00:08, 739.50it/s]     91%|#########1| 59695/65536 [01:18<00:08, 705.37it/s]     91%|#########1| 59771/65536 [01:18<00:08, 720.02it/s]     91%|#########1| 59845/65536 [01:18<00:07, 723.95it/s]     91%|#########1| 59920/65536 [01:18<00:07, 731.27it/s]     92%|#########1| 59996/65536 [01:18<00:07, 737.00it/s]     92%|#########1| 60072/65536 [01:19<00:07, 743.66it/s]     92%|#########1| 60147/65536 [01:19<00:07, 744.56it/s]     92%|#########1| 60222/65536 [01:19<00:07, 744.03it/s]     92%|#########2| 60297/65536 [01:19<00:07, 744.21it/s]     92%|#########2| 60372/65536 [01:19<00:06, 745.57it/s]     92%|#########2| 60447/65536 [01:19<00:06, 746.74it/s]     92%|#########2| 60523/65536 [01:19<00:06, 750.66it/s]     92%|#########2| 60601/65536 [01:19<00:06, 756.76it/s]     93%|#########2| 60679/65536 [01:19<00:06, 761.13it/s]     93%|#########2| 60756/65536 [01:19<00:06, 757.69it/s]     93%|#########2| 60832/65536 [01:20<00:06, 755.95it/s]     93%|#########2| 60910/65536 [01:20<00:06, 761.18it/s]     93%|#########3| 60987/65536 [01:20<00:05, 762.81it/s]     93%|#########3| 61064/65536 [01:20<00:05, 762.87it/s]     93%|#########3| 61142/65536 [01:20<00:05, 765.72it/s]     93%|#########3| 61220/65536 [01:20<00:05, 768.16it/s]     94%|#########3| 61298/65536 [01:20<00:05, 770.02it/s]     94%|#########3| 61376/65536 [01:20<00:05, 771.80it/s]     94%|#########3| 61455/65536 [01:20<00:05, 775.66it/s]     94%|#########3| 61533/65536 [01:21<00:05, 775.69it/s]     94%|#########4| 61611/65536 [01:21<00:05, 775.18it/s]     94%|#########4| 61689/65536 [01:21<00:04, 771.35it/s]     94%|#########4| 61767/65536 [01:21<00:04, 769.04it/s]     94%|#########4| 61845/65536 [01:21<00:04, 770.21it/s]     94%|#########4| 61923/65536 [01:21<00:04, 767.67it/s]     95%|#########4| 62002/65536 [01:21<00:04, 773.59it/s]     95%|#########4| 62080/65536 [01:21<00:04, 772.18it/s]     95%|#########4| 62158/65536 [01:21<00:04, 771.18it/s]     95%|#########4| 62236/65536 [01:21<00:04, 770.13it/s]     95%|#########5| 62314/65536 [01:22<00:04, 770.87it/s]     95%|#########5| 62393/65536 [01:22<00:04, 773.56it/s]     95%|#########5| 62471/65536 [01:22<00:03, 773.48it/s]     95%|#########5| 62550/65536 [01:22<00:03, 778.27it/s]     96%|#########5| 62628/65536 [01:22<00:03, 778.26it/s]     96%|#########5| 62706/65536 [01:22<00:03, 767.97it/s]     96%|#########5| 62784/65536 [01:22<00:03, 768.90it/s]     96%|#########5| 62861/65536 [01:22<00:03, 764.87it/s]     96%|#########6| 62938/65536 [01:22<00:03, 756.02it/s]     96%|#########6| 63014/65536 [01:22<00:03, 756.85it/s]     96%|#########6| 63090/65536 [01:23<00:03, 752.14it/s]     96%|#########6| 63166/65536 [01:23<00:03, 743.28it/s]     96%|#########6| 63242/65536 [01:23<00:03, 745.75it/s]     97%|#########6| 63317/65536 [01:23<00:02, 743.91it/s]     97%|#########6| 63393/65536 [01:23<00:02, 746.42it/s]     97%|#########6| 63468/65536 [01:23<00:02, 747.29it/s]     97%|#########6| 63543/65536 [01:23<00:02, 747.36it/s]     97%|#########7| 63619/65536 [01:23<00:02, 749.43it/s]     97%|#########7| 63695/65536 [01:23<00:02, 750.61it/s]     97%|#########7| 63771/65536 [01:23<00:02, 752.01it/s]     97%|#########7| 63847/65536 [01:24<00:02, 753.67it/s]     98%|#########7| 63923/65536 [01:24<00:02, 752.32it/s]     98%|#########7| 63999/65536 [01:24<00:02, 751.27it/s]     98%|#########7| 64075/65536 [01:24<00:01, 753.48it/s]     98%|#########7| 64153/65536 [01:24<00:01, 758.82it/s]     98%|#########8| 64232/65536 [01:24<00:01, 767.33it/s]     98%|#########8| 64311/65536 [01:24<00:01, 773.60it/s]     98%|#########8| 64391/65536 [01:24<00:01, 779.46it/s]     98%|#########8| 64469/65536 [01:24<00:01, 776.76it/s]     98%|#########8| 64548/65536 [01:24<00:01, 779.59it/s]     99%|#########8| 64626/65536 [01:25<00:01, 778.40it/s]     99%|#########8| 64704/65536 [01:25<00:01, 778.09it/s]     99%|#########8| 64782/65536 [01:25<00:00, 776.86it/s]     99%|#########8| 64860/65536 [01:25<00:00, 775.57it/s]     99%|#########9| 64938/65536 [01:25<00:00, 774.68it/s]     99%|#########9| 65016/65536 [01:25<00:00, 767.92it/s]     99%|#########9| 65093/65536 [01:25<00:00, 736.11it/s]     99%|#########9| 65169/65536 [01:25<00:00, 741.17it/s]    100%|#########9| 65245/65536 [01:25<00:00, 745.24it/s]    100%|#########9| 65322/65536 [01:25<00:00, 751.11it/s]    100%|#########9| 65399/65536 [01:26<00:00, 754.54it/s]    100%|#########9| 65475/65536 [01:26<00:00, 755.12it/s]    100%|##########| 65536/65536 [01:26<00:00, 759.74it/s]




.. GENERATED FROM PYTHON SOURCE LINES 131-136

Print training statistics and plot training error
-------------------------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 136-139

.. code-block:: default

    print(calibrator.stats())
    calibrator.plot_test_accuracy()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :alt: Training error
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Number of training samples: 4194304
            Number of filter coefficients: 2560
            Largets / smallest training error: 1.3e-04 / 1.5e-11
            Number of gradient evaluations: 4194304
            Calibration Time: 1.2e-02 [s]
        




.. GENERATED FROM PYTHON SOURCE LINES 140-143

Extract testing estimate
-------------------------


.. GENERATED FROM PYTHON SOURCE LINES 143-145

.. code-block:: default

    u_hat = calibrator.test(size)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/16896 [00:00<?, ?it/s]     37%|###7      | 6315/16896 [00:00<00:00, 63138.02it/s]     76%|#######5  | 12835/16896 [00:00<00:00, 64346.65it/s]    100%|##########| 16896/16896 [00:00<00:00, 64400.56it/s]




.. GENERATED FROM PYTHON SOURCE LINES 146-149

Visualise PSD of testing data
-----------------------------


.. GENERATED FROM PYTHON SOURCE LINES 149-219

.. code-block:: default


    # uncalibrated
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_uncalibrated[:],
        fs=1 / digital_control.clock.T,
        nperseg=u_hat_cut_uncalibrated.size,
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Uncalibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Ref
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_ref[:], fs=1 / digital_control.clock.T, nperseg=u_hat_cut_ref.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Ref, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Calibrated Est
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat[:], fs=1 / digital_control.clock.T, nperseg=u_hat.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Calibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    plt.title("Power spectral density of input estimate")
    plt.xlabel('Hz')
    plt.ylabel('$V^2$ / Hz dB')
    plt.legend()
    plt.grid(which="both")
    plt.gcf().tight_layout()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :alt: Power spectral density of input estimate
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  0.835 seconds)


.. _sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_h_calibrating_from_numpy_simulator.py <plot_h_calibrating_from_numpy_simulator.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_h_calibrating_from_numpy_simulator.ipynb <plot_h_calibrating_from_numpy_simulator.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
